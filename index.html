<!DOCTYPE html>
<html>
<head>
    <title>버튼 카운터</title>
</head>
<body>
    <button id="countButton">버튼 누르기</button>
    <p id="message"></p>

    <script>
        // 쿠키를 사용하여 중복 클릭 방지
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        // 초기 카운터 값을 쿠키에서 가져옴
        var initialCount = parseInt(getCookie("counterValue")) || 0;

        // 버튼 클릭 시 처리
        document.getElementById("countButton").addEventListener("click", function () {
            if ("geolocation" in navigator) {
                // 사용자의 현재 위치 정보 가져오기
                navigator.geolocation.getCurrentPosition(function (position) {
                    var userLat = position.coords.latitude;
                    var userLng = position.coords.longitude;

                    // 기준 좌표와의 거리 계산 (대략적인 계산법)
                    var distance = Math.sqrt(Math.pow(userLat - 37.1664258, 2) + Math.pow(userLng - 127.1061700, 2));

                    if (distance <= 0.018) { // 2키로 미터 이내 (0.018도 이내)
                        var currentCount = parseInt(getCookie("counterValue")) || 0;
                        if (currentCount === 0) {
                            currentCount++;
                            document.getElementById("message").textContent = "참여하였습니다. 감사합니다.";
                            setCookie("counterValue", currentCount, 1);
                        } else {
                            document.getElementById("message").textContent = "이미 참여하였습니다.";
                        }
                    } else {
                        document.getElementById("message").textContent = "해당 지역이 아닙니다.";
                    }
                });
            } else {
                document.getElementById("message").textContent = "이 브라우저에서는 위치 정보를 지원하지 않습니다.";
            }
        });
    </script>
</body>
</html>
